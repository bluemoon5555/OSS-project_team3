#define _CRT_SECURE_NO_WARNINGS
#include <stdio.h>
#include <windows.h>
#include <stdlib.h>
#include <conio.h>

// --------------- 한 글자씩 출력하는 함수 ---------------
void slowPrintChar(const char* text, int delay) {
    while (*text) {
        // 키 눌렀는지 체크
        if (_kbhit()) {
            _getch(); // 눌린 키 입력 제거

            // 남은 텍스트 한 번에 출력
            printf("%s", text);
            fflush(stdout);
            return;
        }

        putchar(*text);
        fflush(stdout);
        Sleep(delay);
        text++;
    }
}

// --------------- 장면(여러 줄) 출력 후 화면 전환 ---------------
void scene(const char* text) {
    slowPrintChar(text, 28);

    printf("\n\n[Enter 키를 누르면 다음 장면으로 넘어갑니다]");

    while (1) {
        int key = _getch();
        if (key == '\r') break;  // Enter(ASCII 13)만 인정
    }

    system("cls");
}

void printMenu();
void startGame();
void loadGame();

void fileprint(char* f) {  //파일출력함수
    FILE* p = fopen(f, "r");
    if (!p)return;
    char line[500];
    while (fgets(line, sizeof(line), p))printf("%s", line);
    fclose(p);
}

int main() {
    int choice;

    while (1) {
        printMenu();
        printf("\n 숫자를 눌러 선택하세요: ");
        scanf("%d", &choice);

        switch (choice) {
        case 1:
            system("cls"); // 메뉴 화면 지우고 게임 시작
            startGame();
            break;
        case 2:
            loadGame();
            break;
        case 3:
            printf("게임을 종료합니다...\n");
            Sleep(700);
            return 0;
        default:
            printf("잘못된 입력입니다.\n");
            Sleep(700);
        }
    }
    return 0;
}

// ---------------------- 메뉴 ----------------------
void printMenu() {
    system("cls");
fileprint("startmenu.txt");
}


// ---------------------- 게임 시작 ----------------------
void startGame() {
   fileprint("howtoplay.txt");
 int s = _getch();
 while (1) {
     if (s == '\r') {
         system("cls");break;
     }
 }
  fileprint("startgame1.txt");
  Sleep(1000);
  system("cls");
   
    scene(
        "(좁은 원룸, 책상 위에는 노트북과 이력서가 어지럽게 놓여 있다.)\n"
        "(올해로 29살인 최종훈은 00대학교 컴퓨터공학과를 졸업한 뒤 3년째 취업에 실패하고 있다.)\n"
        "최종훈 : ...... 또 떨어졌네.\n"
        "벌써 몇 번째인지도 모르겠는 불합격 통보… 이제는 그냥 무덤덤하다.\n"
    );

    scene(
        "(무기력하게 노트북 화면을 바라보던 최종훈, 갑자기 메일 알람이 울린다.)\n"
        "뭐야... 취업 홍보 메일..? \n"
        "\"월 천만원 보장!!\" \"주 3일 근무!\"...?\n"
        "터무니 없이 파격적인 조건이네...  요즘같은 불경기에 정말 이런 조건으로\n"
        " 사람을 뽑는 회사가 있을까.. ? ?\n "
    );
   
    scene(
        "(메일 스크롤을 계속해서 내린다.)\n"
        "무경력자 환영...탄력적 근무...임사 시 월급과 별도로 500만원 지급?!\n"
        "조금 의심스럽긴 하지만... \n"
        "이런 파격적인 조건을 제시하는 곳에서\n"
        "제대로 시작해보는게 나을지도..."
    );

    scene(
        "(취업홍보메일을 보낸 회사와 연락하여 면접약속을 잡은 최종훈은 안내받은 장소를 향했다.)\n"
        "(면접 장소로 지정된 외곽의 산업단지. 최종훈이 버스에서 내려 주변을 둘러본다)\n"
        "여기가 맞나? 왜 이렇게 사람이 없지...\n"
        "(골목 안쪽에서 검은색 벤이 서 있다. 차량 주위에 온몸이 문신으로 뒤덮인 덩치 큰 남자들이 서 있는 모습이 위화감을 준다)\n"
        "(위화감을 느낀 최종훈이었지만 일단은 차량에 탑승해서 면접장소로 향하기로 한다.)\n"
    );

    scene(
        "최종훈 :  저기... 회사가 어디쯤에...\n"
        "(퍽!!!)\n"
        "(최종훈의 말이 끝나기도 전에 둔기가 그의 머리에 강하게 내리꽂혔다.)\n"
        "이게... 무슨......\n"
        "(최종훈은 시야가 점점 흐려지며 의식을 잃게 되었다.)"
    );

   

   
    scene(
        "보스 : 잠에서 깬 모양이군.\n"
        "(날카로운 눈매의 중년 남성과 두 명의 거구가 방 안으로 들어온다)\n"
        "최종훈 : 이건... 무슨 상황이에요?\n"
        "보스 : (비웃으며) 간단히 말해, 넌 이제 우리의 새 식구야.\n"
        "(한 남자가 최종훈의 지갑과 휴대폰을 빼앗는다)\n"
        "최종훈 : 잠깐만요! 그건 제...\n"
    );

    // ---- 장면 11 ----
    scene(
        "보스 : (냉랭하게) 이제부터 네 일은 두 가지다. 보이스피싱 업무, 불법 도박사이트 관리.\n"
        "최종훈 : 네...?! 제가 어째서 ...... 절대로 신고하지 않을테니 제발 풀어주세요....\n"
        "보스 : (웃음을 터뜨리며) 여기서 나갈 생각은 접어라. 너 처럼 멍청하게 잡혀들어와서 탈출한 사람은 지금까지 한명도 없으니깐\n"
        "(방 밖에서 다른 사람의 울음소리가 들려온다)"
    );


    scene(
        "보스 : 내일부터 바로 업무 시작이야. 맡은 업무를 제대로 안 하면... (의미심장한 눈빛을 던지며) 후회하게 될거야..\n"
        "(문이 닫히고 전자식 잠금장치가 작동하는 소리가 난다)\n"
        "(최종훈이 벽에 기대여 주저않는다)\n"
        "이게 무슨...  상황인거야.....?"
    );
    scene(
        "(어두운 감방 안, 최종훈이 노트북 앞에 앉아 있다. 눈아래에는 다크서클이 짙게 내려앉고, 몸에는 피멍자국이 선명하다)\n"
        "또 하루가 시작됐어... 이 지옥 같은 곳에서...\n"
        "(노트북을 켜며 타이핑을 하지만, 손가락이 부들부들 떨린다)\n"
        "보이스피싱 스크립트 작성, 도박사이트 관리...\n"
        "내가 대학에서 배운 컴퓨터 공학이 이럴 때 쓰일 줄이야..."
    );
    scene(
        "(문이 열리고 상한 빵 한 조각과 물컵이 던져진다)"
        "이런 걸로 어떻게 살아...\n"
        "벌써 한 달째인데 살이 10kg는 빠진 것 같아...\n"
    );
    scene(
        "(갑자기 복도에서 둔탁한 타격음과 고통의 비명소리가 들려온다)\n"
        "조직원 : 이번주까지 할당량 못채우면 좋은꼴 못볼꺼라고 했지!!!!!\n"
        "납치 피해자 : 죄..죄송합니다..! 조금만더 시간을 주시면...!  아악!!!!!\n"
        "또 시작인가....."
    );
    scene(
        "나를 납치해온 범죄집단은 체계적인 보이스피싱과 불법도박사이트 운영으로 범죄수익을 창출하는 조직이다.\n"
        "나 이외에도 비슷한 방식으로 납치를 당해와서 강제로 불법적인 업무를 강요당하는 사람들이 여럿 존재하는것 같다.\n"
        "나를 포함한 납치피해자들은 주7일 하루 16시간이상의 강제노동을 강요당하고,\n"
        "일정기간동안 정해진 성과를 내지못하면 가혹한 구타 및 가혹행위가 이루어졌다.\n"
        "이런 생활.... 지긋지긋해......"
    );
    scene(
        "(갑자기 문이 열리며 조직원이 들어온다)\n"
        "조직원 : 어이, 너  이번주 할당량 채웠어? (최종훈의 노트북 화면을 힐끔 보며)\n"
        "최종훈 : 지, 지금 하고 있습니다...\n"
        "조직원 : 내일까지 못 채우면 저놈처럼될 줄 알아. (씨익 웃으며 으스대는목소리로)\n"
        "(문이 다시 닫히고, 최종훈의 손이 부들부들 떨린다)"
    );
    scene(
        "더는... 더는 이렇게 살 수 없어...\n"
        "(창문 너머로 보이는 쇠창살을 바라보며)\n"
        "탈출해야 해...\n"
        "무슨 일이 있어도...\n"
        "(주먹을 꽉 쥐고 마음속으로 다짐한다)\n"
        "탈출하다 죽는한이 있더라도 여기서 나가겠어..."
    );
    scene("...........");
    scene(
        "(며칠 뒤, 최종훈은 다른 피해자들과 함께 건물 청소 작업에 동원되었다)\n"
        "이곳에서는 가끔 피해자들을 외부 작업에 동원하곤 한다. \n"
        "물론 자유롭게 건물을 돌아다닐 수 있는 것은 아니다.\n"
        "경비원들의 감시를 받으며, 오직 지시받은 작업만 수행할 수 있을 뿐...\n"
    );
    scene(
        "그러나 이 시간이 유일했다.\n"
        "\n"
        "좁은 독방을 벗어날 수 있는 유일한 시간이었고,\n"
        "건물 구조를 파악하고 탈출에 필요한 정보를 얻을 수 있는\n"
        "유일한 기회였다."
    );
    scene(
        "(그렇게 최종훈은 외부작업에 동원될때마다 차근차근 정보를 모아나갔다)\n"
        "(그 결과, 최종훈은 이 건물이 4층 규모의 건물이며,\n"
        "정문 외에는 모두 2m 높이의 가시 담장으로 막혀 있다는 것을 알게 되었다.\n"
        "정문은 열쇠로만 열 수 있는 철문이었고,\n"
        "1층에는 열쇠함이 있는 방, 2층에는 보안실이 있다는 사실도 파악했다.)"
    );
}


// ---------------------- LOAD ----------------------
void loadGame() {
    system("cls");
    slowPrintChar("LOAD 기능은 아직 준비중입니다.\n", 30);
    slowPrintChar("추후 체크포인트 기능이 추가됩니다.\n", 30);
    slowPrintChar("메뉴로 돌아갑니다...", 30);
    Sleep(1500);
    system("cls");
}

